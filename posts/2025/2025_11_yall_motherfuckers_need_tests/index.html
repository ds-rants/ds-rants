<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="DS Rants">
<meta name="dcterms.date" content="2025-10-20">

<title>Y’All Motherfuckers Need Tests – Data Science Rants</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-5d4073339ea55b1ad5ce071f10a273ff.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-9433ce5a74f539ffa23693f38c94ac7f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="quarto:status" content="draft">


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Data Science Rants</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Y’All Motherfuckers Need Tests</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">data science</div>
                <div class="quarto-category">software engineering</div>
                <div class="quarto-category">tests</div>
                <div class="quarto-category">best practices</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>DS Rants </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#big-brain-moment" id="toc-big-brain-moment" class="nav-link active" data-scroll-target="#big-brain-moment"><span class="header-section-number">1</span> Big Brain Moment</a></li>
  <li><a href="#i-am-a-simple-data-scientist-are-you-sure-i-need-tests" id="toc-i-am-a-simple-data-scientist-are-you-sure-i-need-tests" class="nav-link" data-scroll-target="#i-am-a-simple-data-scientist-are-you-sure-i-need-tests"><span class="header-section-number">2</span> I Am A Simple Data Scientist, Are You Sure I Need Tests?</a>
  <ul class="collapse">
  <li><a href="#why-should-i-test" id="toc-why-should-i-test" class="nav-link" data-scroll-target="#why-should-i-test"><span class="header-section-number">2.1</span> Why Should I Test?</a></li>
  <li><a href="#because-most-data-science-projects-never-reach-production" id="toc-because-most-data-science-projects-never-reach-production" class="nav-link" data-scroll-target="#because-most-data-science-projects-never-reach-production"><span class="header-section-number">2.2</span> Because Most Data Science Projects Never Reach Production</a></li>
  <li><a href="#the-main-types-of-tests" id="toc-the-main-types-of-tests" class="nav-link" data-scroll-target="#the-main-types-of-tests"><span class="header-section-number">2.3</span> The Main Types of Tests</a></li>
  </ul></li>
  <li><a href="#adopting-a-testing-strategy" id="toc-adopting-a-testing-strategy" class="nav-link" data-scroll-target="#adopting-a-testing-strategy"><span class="header-section-number">3</span> Adopting A Testing Strategy</a>
  <ul class="collapse">
  <li><a href="#no-tests-at-all" id="toc-no-tests-at-all" class="nav-link" data-scroll-target="#no-tests-at-all"><span class="header-section-number">3.1</span> No Tests At All</a></li>
  <li><a href="#writing-tests-after-writing-the-code" id="toc-writing-tests-after-writing-the-code" class="nav-link" data-scroll-target="#writing-tests-after-writing-the-code"><span class="header-section-number">3.2</span> Writing Tests After Writing The Code</a></li>
  <li><a href="#writing-tests-and-code-at-the-same-time" id="toc-writing-tests-and-code-at-the-same-time" class="nav-link" data-scroll-target="#writing-tests-and-code-at-the-same-time"><span class="header-section-number">3.3</span> Writing Tests And Code At The Same Time</a></li>
  <li><a href="#writing-tests-before-any-code" id="toc-writing-tests-before-any-code" class="nav-link" data-scroll-target="#writing-tests-before-any-code"><span class="header-section-number">3.4</span> Writing Tests Before Any Code</a></li>
  </ul></li>
  <li><a href="#the-top-7-obstacles-that-prevent-you-from-testing" id="toc-the-top-7-obstacles-that-prevent-you-from-testing" class="nav-link" data-scroll-target="#the-top-7-obstacles-that-prevent-you-from-testing"><span class="header-section-number">4</span> The Top 7 Obstacles That Prevent You From Testing</a></li>
  <li><a href="#specific-problems-with-testing-in-data-science" id="toc-specific-problems-with-testing-in-data-science" class="nav-link" data-scroll-target="#specific-problems-with-testing-in-data-science"><span class="header-section-number">5</span> Specific Problems With Testing In Data Science</a>
  <ul class="collapse">
  <li><a href="#the-hidden-forms-of-couplings" id="toc-the-hidden-forms-of-couplings" class="nav-link" data-scroll-target="#the-hidden-forms-of-couplings"><span class="header-section-number">5.1</span> The Hidden Forms Of Couplings</a></li>
  <li><a href="#issues-with-dataframe-like-testing-and-remediation-strategies" id="toc-issues-with-dataframe-like-testing-and-remediation-strategies" class="nav-link" data-scroll-target="#issues-with-dataframe-like-testing-and-remediation-strategies"><span class="header-section-number">5.2</span> Issues With Dataframe-Like Testing And Remediation Strategies</a></li>
  </ul></li>
  <li><a href="#testing-at-larger-scale" id="toc-testing-at-larger-scale" class="nav-link" data-scroll-target="#testing-at-larger-scale"><span class="header-section-number">6</span> Testing At Larger Scale</a>
  <ul class="collapse">
  <li><a href="#what-about-integration-testing" id="toc-what-about-integration-testing" class="nav-link" data-scroll-target="#what-about-integration-testing"><span class="header-section-number">6.1</span> What About Integration Testing?</a></li>
  <li><a href="#acceptance-testing-in-the-data-world-a.k.a-evaluation" id="toc-acceptance-testing-in-the-data-world-a.k.a-evaluation" class="nav-link" data-scroll-target="#acceptance-testing-in-the-data-world-a.k.a-evaluation"><span class="header-section-number">6.2</span> Acceptance Testing In The Data World a.k.a Evaluation?</a></li>
  <li><a href="#the-holy-grail-of-data-tests" id="toc-the-holy-grail-of-data-tests" class="nav-link" data-scroll-target="#the-holy-grail-of-data-tests"><span class="header-section-number">6.3</span> The Holy Grail Of Data Tests</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#good-reading" id="toc-good-reading" class="nav-link" data-scroll-target="#good-reading">Good Reading</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<section id="big-brain-moment" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="big-brain-moment"><span class="header-section-number">1</span> Big Brain Moment</h2>
<blockquote class="blockquote">
<p>“To me, legacy code is simply code without tests.”</p>
</blockquote>
<p><em>Michael C. Feathers, Working Effectively with Legacy Code</em></p>
<blockquote class="blockquote">
<p>“With tests, we can change the behavior of our code quickly and verifiably. Without them, we really don’t know if our code is getting better or worse.”</p>
</blockquote>
<p><em>Michael C. Feathers, Working Effectively with Legacy Code</em></p>
<p>Note: <a href="https://grugbrain.dev/">Big Brain Reference</a></p>
</section>
<section id="i-am-a-simple-data-scientist-are-you-sure-i-need-tests" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="i-am-a-simple-data-scientist-are-you-sure-i-need-tests"><span class="header-section-number">2</span> I Am A Simple Data Scientist, Are You Sure I Need Tests?</h2>
<p>Which blog are you on? <em><strong>Data Science Rants!</strong></em> Of course you need tests!</p>
<section id="why-should-i-test" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="why-should-i-test"><span class="header-section-number">2.1</span> Why Should I Test?</h3>
<p>Because it would be nice to have a data science project working once in a while that is not a complete dumpster-fire. Just for context and reference, for developers nowadays the question is not “should I automate my tests?” but how, when, on which infrastructure to mirror prod as close as possible, and independently from other people working on different features. All senior developers advocate for regular and comprehensive testing strategies. The “State of DevOps” reports shows testing as a major component of team performance and software reliability.</p>
<p>Sure, a lot of “recent” advances in the Developer and DevOps world have yet to make their entrée in the data world (<a href="https://www.youtube.com/watch?v=459-H33is6o">Data: The Land That DevOps Forgot</a>). One could say that we are poorly equipped in terms of tooling, but one could also say that we missed the fucking memo. Some alleged data scientists will happily tell you that they don’t version their code without trembling… Also, good luck convincing a junior DS to do something outside of his notebook without throwing a panic fit, or to fully automate his model selection/deployment by a simple CI/CD pipeline, you’ll get an idea of what I mean.</p>
<p>Yet, the data science people are still curled up in a fetal, near-autistic position regarding developer best-practices, meaning these concepts are usually totally absent of our average workflows. In the end, why should we adopt something like this that is usually so different from our ways?</p>
</section>
<section id="because-most-data-science-projects-never-reach-production" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="because-most-data-science-projects-never-reach-production"><span class="header-section-number">2.2</span> Because Most Data Science Projects Never Reach Production</h3>
<p>This means we are wasting time, money, and worse, we are wasting efforts in dead projects when we could do more interesting and useful things for society. But it’s fine because we have always been told that companies are the pinnacle of efficiency.</p>
<p>However, this bitter state of the data science profession is grounded in some harsh realities. In addition to the absence of best practices of software engineering, we are usually in a much worse situation than typical developers. Indeed, we have by nature a particularly strong coupling to the data (shocker right?). Even small changes over time in the data distribution tend to have tremendous impact on machine learning systems, even though the structure of the data itself stays the same. And you know when that happens? <em>All the damn time for every damn use-case!</em></p>
<p>Finally, we usually need to produce large amounts of code to determine if a given model or analysis has even a chance of being remotely useful. This creates a tension because the code seems constantly in a superposition of state: useless exploratory junk <em>AND</em> awesome preprocessing for big gains model. Then some very natural cognitive mechanism step in: “I don’t need a test because I don’t know if my code has any worth”. It is too late at this point, because we will see the tremendous forces that prevent us from writing tests after the code.</p>
<p>Facing those difficulties means we need discipline, and one hell of a kind! We need to import best practices from other disciplines of IT, that have demonstrated effectiveness in creating reliable software.</p>
<p>One of these practices is testing, so let’s recap briefly some generalities.</p>
</section>
<section id="the-main-types-of-tests" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="the-main-types-of-tests"><span class="header-section-number">2.3</span> The Main Types of Tests</h3>
<p>Unless you are living under a rock, you probably heard of unit, integration and acceptance testing. If you want a good definition go see <a href="https://martinfowler.com/testing/">Martin Fowler Website</a>, in the meantime my pseudo-standard definition will be:</p>
<ul>
<li><p><strong>Unit tests:</strong> performed to validate the behavior of isolated functions and methods (more rarely classes and modules). Fast: &lt; 1 ms.</p>
<p>My personal grain of salt: Without any dependency to I/O or external systems (disk access, internet, database…), with absolute control of inputs and precise evaluations of outputs.</p></li>
<li><p><strong>Integration tests:</strong> performed on a collection of functions, usually at the level of classes and modules. Slower in general but a few seconds max.</p>
<p>I/O becomes possible, but my hot-take is: you should only interact with local elements (mostly disk, local database replica, components or binaries from other sub-systems) and nothing that touches the internet.</p></li>
<li><p><strong>Acceptance tests:</strong> performed on critical paths of the system to ensure key functionalities. Much slower and should aim to be around a few minutes or even lower, otherwise they are ran less often, and start to lose their value.</p>
<p>Here, you can interact with other external systems over the network database and such, but beware, beware!</p></li>
</ul>
<p>These 3 types of tests constitute the cornerstone of a good and fully automated test suite, that will allow you to determine with confidence if your system is working and behaving as expected. Now, one question remains when should you write your tests?</p>
</section>
</section>
<section id="adopting-a-testing-strategy" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="adopting-a-testing-strategy"><span class="header-section-number">3</span> Adopting A Testing Strategy</h2>
<section id="no-tests-at-all" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="no-tests-at-all"><span class="header-section-number">3.1</span> No Tests At All</h3>
<p>You, sir, are dangerous. You should be thrown in jail, and your ugly, dishonest and deceiving notebook code should be lit on fire. You are basically handing over a pile of garbage to your coworkers and yell as you exit the building:</p>
<blockquote class="blockquote">
<p>“And good luck with any changes in business requirements, upgrade in package versions, refactoring or generally future evolutions, because you know it works on my machine…oh and by the way, the business wants this model in production next week…”</p>
</blockquote>
<p>I despise you with every fiber of my being and will definitively high five you at the first occasion… in the face… with a shovel…</p>
</section>
<section id="writing-tests-after-writing-the-code" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="writing-tests-after-writing-the-code"><span class="header-section-number">3.2</span> Writing Tests After Writing The Code</h3>
<p>Either you probably have good intentions and don’t know how to do it but you heart is in a good place. Or you have been told to write tests by a concerned tech lead, because the prod was on fire 3 times this week, and you reluctantly follow the orders as a good soldier. Regardless there are a few problems with that approach:</p>
<ol type="1">
<li><p>Assuming you are a not complete moron, you have at least run and tested your code manually, visually, or made sure it compiled. Strangely, the idea of writing a test already starts to lose meaning because you just saw it with you own eyes: the code is running. This mental block is, to me, and by far, the largest factor that prevents juniors from realizing the value of automated tests.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Really, that’s the main danger. The code runs, you just saw it. Then the brain automatically disconnects, and then lingering thought comes up: “Do I really need a test?”. This is where it all ends.</p>
</div>
</div></li>
<li><p>In addition, writing the test afterwards will be extremely painful and difficult, because your code has not been written with testability as a core requirement. Then you will need some decent luck, and great efforts to isolate some deterministic behavior in a 100 lines of spaghetti with mutations everywhere and no clear responsibilities.</p></li>
<li><p>As a direct consequence, the tests also tend to become coupled with the implementation details, making them brittle, or flaky, and generally more difficult to maintain. The typical example is when you want to change one line in your production code; you clearly see the change, but then you also have to change 20 tests… This is usually a sign of bad coupling between tests and implementation.</p></li>
<li><p>Some large chunks of the system will very likely escape any form of testing (a consequence of <code>reason N°2.</code>) because of the impossibility to control their inputs and outputs.</p></li>
</ol>
<p>Regardless, writing tests after will probably be a lot of pain, especially if a higher-up dropped a decaying legacy project on your lap. In which case you should turn to experts, that will tell you how to effectively <a href="https://youtu.be/P_6eDL1aqtA?si=DieijfL9LdZeWTlj">test and manage complexity of legacy codebase (remember code without tests)</a>.</p>
</section>
<section id="writing-tests-and-code-at-the-same-time" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="writing-tests-and-code-at-the-same-time"><span class="header-section-number">3.3</span> Writing Tests And Code At The Same Time</h3>
<p>Now we are finally getting somewhere. Most of the issues mentioned in the previous section start to erode, with the main exception of <code>reason N°3</code>. The main risk with writing tests at the same time as the code, is to increase the coupling between the test and the code, beyond what is strictly required. This reduces maintainability and limits future changes and evolution.</p>
<p>However, there are cases where this approach can be actually fruitful, especially for certain scopes and contexts (More on that later).</p>
</section>
<section id="writing-tests-before-any-code" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="writing-tests-before-any-code"><span class="header-section-number">3.4</span> Writing Tests Before Any Code</h3>
<p>At last, for any sleeping data scientist that managed to open an eyelid, this is the bread and butter of any self-respecting developer these days. This is called Test-Driven Development, a.k.a. <strong>TDD</strong>, and this is <a href="https://www.youtube.com/watch?v=B1j6k2j2eJg">how to do it properly</a>:</p>
<ol type="1">
<li><strong>RED:</strong> You write a <strong>failing</strong> test, which, from well-defined inputs, asserts that a given piece of code has certain well-defined outputs. This is akin to writing specifications in the code.</li>
<li><strong>GREEN:</strong> You write the smallest, most simplistic, even idiotic code you can think of to make the test pass. Nothing more!</li>
<li><strong>REFACTOR:</strong> You replace the idiotic part you just wrote with something less stupid or ugly. <strong>But pay attention!</strong> You should not write anything that is not inside the test. The point is to let the tests and specifications drive the code.</li>
</ol>
<p>And you repeat the cycle!</p>
<p>This (apparently contrived) way of testing has dramatic advantages:</p>
<ul>
<li>It completely breaks the idea of: “I don’t need a test because I just saw my code run” because the code does not even exist yet.</li>
<li>You are writing specifications for the observable behavior in the tests, not implementation details, meaning tests and code are less coupled.</li>
<li>It forces you to write code in very small, incremental steps, and all the great old wizards of software engineering are pretty much saying this is the best way to work, period!</li>
<li>You are usually able to fall back to working code with a bunch of automated tests within a few seconds. This is such a change that Kent Beck, the guy who coined the term TDD, called it Xanax for developers!</li>
<li>The code becomes easier to test because you are writing with a clear goal to make it testable, otherwise you’re just making your life difficult. Duh!</li>
<li>The incremental nature forces a progressive decoupling between the code and the test, which is a great sign for maintainability and increases the possibility of future changes.</li>
<li>Because you want the things to be easy to test, you naturally limit the scope of what your functions/classes can do, which increases their internal cohesion. They tend to do fewer things but do them better.</li>
</ul>
<p>Overall writing tests first has such a strong impact on your design. Namely, it prevents you from doing stupid shit, like becoming your worst enemy and face-planting your project 3 meters underground. You will actually keep the possibility to continue making changes to your code (see the <strong>excellent youtube channel</strong> <a href="https://www.youtube.com/@ModernSoftwareEngineeringYT/videos">Modern Software Engineering</a>). Ain’t that good enough in itself?</p>
<blockquote class="blockquote">
<ul>
<li>“But Sir Rants, if TDD is that good, why are data scientists not doing it?”</li>
<li>“Young lad, thank you for the very interesting question, allow me to introduce you to: …”</li>
</ul>
</blockquote>
</section>
</section>
<section id="the-top-7-obstacles-that-prevent-you-from-testing" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="the-top-7-obstacles-that-prevent-you-from-testing"><span class="header-section-number">4</span> The Top 7 Obstacles That Prevent You From Testing</h2>
<p>Dear reader, I apologize for the sudden surge of click-bait writing style, but this will likely be a long post, anyhow…</p>
<p>Writing tests is difficult, even for seasoned developers. However, writing tests first with TDD is actually easier but also requires a strong shift of mindset. In this bit we are going to focus mostly on unit tests. Reminder the features of good unit-tests are: <em>fast, deterministic, reproducible, decoupled from implementation details</em>.</p>
<ol type="1">
<li><p>Most people advocating for the practice of TDD will repeat that it is an acquired skill, one that you need to train regularly. It will take you time and practice to master it. Do not try to jump directly with code in the old legacy project if you have never written an automated test. You are setting yourself up for failure.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Start practicing regularly with simple code katas, do not try to jump directly to writing tests for legacy codebases or data science workflows. It will very likely take you at least 3-4 months to get comfortable with the basics of testing</p>
<p>If possible use a small side project at work where your hands are free to move.</p>
</div>
</div></li>
<li><p>The more you wait to incorporate tests in your workflow, the more difficult it will get to do it. Imagine after 6 months of crunching and regurgitating code, saying to your Product Manager, that suddenly you want to write tests because one day you woke up and decided you cared about quality (hopefully after reading this rant).</p>
<p>Now imagine that at the start of your project, you said to that blissfully unaware PM: “There shall be a test for every bit of code produced, and no test means no code, means no feature!”. The only possible answer for that PM will be: “Amen”.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Start adopting a testing strategy as soon as possible in the project lifetime. In the extremely likely case of a legacy project, you must be aware that some bits will be extremely difficult to test. This is where practicing in isolation first (step 1.) will save you on more than a couple of occasions. Find the separations inside the codebase where testing is possible in isolation, move it apart from the rest of the junk. Test the newly produced code.</p>
</div>
</div></li>
<li><p>The things you will try to test at first will probably be too large, and the scope poorly defined. This will make the size of the inputs probably larger than what would be reasonable.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try to really limit the size, scope, functionalities you try to test at a given time. Take a smaller sized approach.</p>
</div>
</div></li>
<li><p>One very common error is to try to test the main functionality of a future piece of code right from the get-go. Rookie mistake! This is like head-butting a piece of concrete to make a wall fall down, it might work but you might not be able to repeat that feat once your skull is cracked open.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not jump directly to the core of the functionalities; start with the simple things and let the behavior progressively emerge from the iterative process. Let’s take an idiotic example, imagine you want to sort elements of a list. Rather than giving a list of 10 numbers and making sure they are sorted in the end, start by passing an empty list (Great! We just found an edge-case!), then perhaps a list with one element (shocker, input and output should be the same…).</p>
</div>
</div></li>
<li><p>You will probably try to test things while reading from the disk or worse the network or the database. You should refrain from committing such ungodly horrors. This will make your unit-tests slow, way too slow and sometimes brittle and flaky.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Stay away from any kind of I/O, i.e.&nbsp;disk reads or writes, network calls, database calls, cloud interaction. They do not belong in your unit-testing strategy, and even in integration testing, use them only if they <strong>REALLY CAN NOT BE AVOIDED</strong>.</p>
</div>
</div></li>
<li><p>Not knowing your testing framework is a pretty good way to butcher and obscure your test suite. Similarly, you can abuse mocking and stubbing your classes and functions, to ensure that nobody, not even you in two weeks, understands whatever the test is doing. Continue in that direction, and you will even create tests that assert nothing at all!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take the time to understand how your testing framework is designed, what it allows you to reuse and what you should rewrite. Limit the mocking to the strict minimum to avoid dependencies to external services, but beware of their dark side.</p>
</div>
</div></li>
<li><p>Not properly setting up your local environment, and not learning to use your IDE/text editor is a very good way to set you up for failure. Although it may seem secondary, you absolutely need to properly configure and be comfortable with your local environment, to help you write tests and navigate your code. Otherwise it will become a mental blocker and a hidden obstacle to your workflow.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Solution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Install test extensions or plugins for your language inside your editor. You need first-class support to be able to run a single test, or all of them for a given class/file. Your whole test suite should run at will, using single click or a small terminal call.</p>
</div>
</div></li>
</ol>
<p>This list of recommendations is a watered down version of the many pieces of advices available in the sources and links of this rant. Please go check them out.</p>
</section>
<section id="specific-problems-with-testing-in-data-science" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="specific-problems-with-testing-in-data-science"><span class="header-section-number">5</span> Specific Problems With Testing In Data Science</h2>
<section id="the-hidden-forms-of-couplings" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="the-hidden-forms-of-couplings"><span class="header-section-number">5.1</span> The Hidden Forms Of Couplings</h3>
<p>As mentioned previously for the ones sleeping in the back of the classroom, data scientists largely deal with large collections of records.</p>
<p>Writing tests in data science is particularly difficult because most of the objects we deal with are collections of items, usually quite complex. Those items are usually independent only in the best case scenarios but most likely related to each other in some kind of nasty way. How many times did you have to do an analysis in which on record at a given time strongly influence what was to be done on surrounding elements, but only until variable B changes to a different value?</p>
<p>You don’t believe me? Let’s assume for ungodly reasons, that you can only use 50% of your dataset for training your model, are you keeping the latest 50%, the oldest, or randomly discarding data? Even if we strip out this made-up convoluted scenario, I cannot recall, since I started working in the industry, a single real-life dataset in which time played no role at all in some kind of weird way or disguised influence (say goodbye to your kaggle/tutorial static datasets).</p>
<p>This question can remain largely secondary in the pure ‘developer’ world. Indeed, as long as the objects themselves remain valid and the code processing them remains correct, then the system is working properly. This is a strong yet hidden form of coupling which is difficult to circumvent in automated tests but is a major concern for any data science workflow. It is not the only one though.</p>
</section>
<section id="issues-with-dataframe-like-testing-and-remediation-strategies" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="issues-with-dataframe-like-testing-and-remediation-strategies"><span class="header-section-number">5.2</span> Issues With Dataframe-Like Testing And Remediation Strategies</h3>
<p>As mentioned previously for the ones sleeping in the back of the classroom, data scientists largely deal with large collections of records. For a data scientist, writing meaningful unit-tests may require decent amount of boilerplate even for some simple data and light transformations. This assumes a processing done largely on some kind of dataframe/array (which will encompass 95% of the <code>pandas</code> and <code>numpy</code> junkies).</p>
<p>I will assume you have a shred of decency for your coworkers, meaning your transformations look like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>daily_awesome_calculations <span class="op">=</span> (</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    original_record_with_meaningful_name</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">drop_nulls</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(<span class="op">...</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">group_by</span>(<span class="st">"day"</span><span class="op">,</span> <span class="st">"categorical_variable_B"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">agg</span>(<span class="op">...</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If not please go see <a href="../../../posts/2025/2025_04_13_your_pandas_code_is_bad/index.html">here</a> and <a href="../../../posts/2025/2025_04_28_angry_pandas_guide/angry_pandas_tutorial.html">there</a>.</p>
<p>Here with the use of <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> (Domain-specific language) like <code>pandas</code> / <code>polars</code>/ <code>numpy</code>, it can be tricky to determine if you are actually testing <strong>your custom</strong> logic or re-testing the methods of the library that are already (hopefully) battle-tested.</p>
<p>For a dataframe test that is not excruciating to write, one needs to strip away all the surrounding complexity. This requires the ability to use the smallest amount of rows and columns. A good rule of thumb is usually 2-Rows * x-Columns or 3-Rows * x-Columns to get you started. If you can manage with only one row, you should! Expressing this again requires a fairly decent bit of expertise to determine the seams / separations in your coding where to make testing easier.</p>
<p>Regardless, here are some simple pointers:</p>
<ol type="1">
<li><p>Separate dataframe and pure Python logic as much as you can. Generally speaking, mixing pandas and Python, is a sure-fire way to make your code slow and in most cases, false. Additionally, Python logic is much easier to perform unit tests on.</p></li>
<li><p>Unit testing on dataframes is still possible with very small examples. Keep things as simple as you can with very small data subsets, here again, shapes of 2-Rows * x-Columns or 3-Rows * x-Columns or even smaller are your best friends. LLMs can help you with the first draft of the boilerplate. Once you have the general structure, it can usually be reused on multiple tests.</p></li>
<li><p>Make the data inside the example dataframe as plain, idiotic and stupid simple as possible (during test setup or ‘given’ stage). This will likely decrease the coupling with your implementation code. It will also increase the maintainability of your test in the long run.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>given <span class="op">=</span> pd.DataFrame(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"station"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>],</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"temperature"</span>: [<span class="fl">1.1</span>, <span class="fl">2.3</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>is better than:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>given <span class="op">=</span> pd.DataFrame(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"station"</span>: [<span class="st">"NZ_EXT_1"</span>, <span class="st">"DE_INT_42"</span>],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"temperature"</span>: [<span class="fl">1.132554</span>, <span class="fl">2.3738687</span>],</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Testing on dataframes requires more skill and time to get used to than non-data science code. Again practice testing on pure Python first before jumping straight into the complexity ocean. Similarly, practice on things with smaller scope at first.</p></li>
<li><p>Be wary of the scope. With too many steps and too much logic, you might have to make your tests extremely permissive. For example, just checking that you have more rows in your dataframe after 30 transformations is unlikely to be highly informative…</p></li>
</ol>
</section>
</section>
<section id="testing-at-larger-scale" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="testing-at-larger-scale"><span class="header-section-number">6</span> Testing At Larger Scale</h2>
<p>There is a sort of opposition between scale and ease of applying TDD principles. Indeed the cornerstone of a good testing strategy is <strong>to obtain a fast, reliable and deterministic feedback</strong> that allows the IT practitioner to have confidence that the proposed changes are safe to release. Accounting for all use-cases in the integration and acceptance steps would make the testing unnecessarily slow, bulky and in the end useless.</p>
<section id="what-about-integration-testing" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="what-about-integration-testing"><span class="header-section-number">6.1</span> What About Integration Testing?</h3>
<p>The role of integration testing is to make sure that the sub-components and modules of your system are working properly and fit together to produce some expected behavior.</p>
<p>In the Data Land, integration tests can be usually done by taking a larger chunk of your datasets (plural, because have you ever seen a project with just one…). For example in Machine Learning workflows, you can try to pass the smallest possible amount of data through your preprocessing, then assert that you indeed got rid of certain columns, managed to remove nulls in certain others.</p>
<p>You can then continue passing this small sample through your training and at least make sure that the training is able to start. There is a tremendous difference between fully automating this and using a pseudo manual verification (either inside a notebook, or via a CLI that you might forget to type).</p>
<p>Again the point here, is to ensure that preprocessing, training, evaluation and similar components can feed into each other, not to talk about model performance, nor to tune hyper-parameters.</p>
</section>
<section id="acceptance-testing-in-the-data-world-a.k.a-evaluation" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="acceptance-testing-in-the-data-world-a.k.a-evaluation"><span class="header-section-number">6.2</span> Acceptance Testing In The Data World a.k.a Evaluation?</h3>
<p>Traditionally, acceptance tests are designed to verify the bare minimum working state of your system, again by validating the critical or major hot paths within your application. Similarly, they also tend to appear later through the life of IT projects, once the scope become clearer.</p>
<p>With them you should be able to obtain a definitive answer to the question: “Is my system in a working state so that it can be deployed?” In that regard, data science systems make no exceptions; this is where you will be able to plug in your database, buckets and APIs.</p>
<p>In ML workflows, the automated evaluation of a model’s performance, comparison with a previously deployed model can usually be a good approach for acceptance testing. However the scope of this question is so large that tons of books have been written on the subject, and sadly, this blog has very little to offer in comparison (especially on the politically correct side of things…). The final strategy will vary very much depending on the size of your data, the necessary retraining frequency, the selected metrics and type of model considered. The main point remains: automate this as much as you can!</p>
</section>
<section id="the-holy-grail-of-data-tests" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="the-holy-grail-of-data-tests"><span class="header-section-number">6.3</span> The Holy Grail Of Data Tests</h3>
<p>Data tests, also called defensive testing, are here to validate… the data! They stand in a weird position because we mainly see them at the level of the whole data pipeline, although they can fit at many levels of the testing pyramid. These tests ensure that you actually got a primary key (unique <strong>and</strong> non-null for the sleepy ones), that numeric columns fit within a certain range, that you got rid of null…</p>
<p>This is where <code>dbt</code>, <code>dataform</code>, <code>SQLMesh</code> and similar SQL-based frameworks really shine by allowing you to test data at a large scale. Using such frameworks, it is still possible to write code using TDD. Simply, rather than starting to write SQL code, you will start by specifying in the metadata the types and the tests for a given column. They are obviously SQL oriented but their contribution to our field is really a game changer.</p>
<p>In Python, few packages have been developed to help you use a TDD workflow in data science. One issue is perhaps that they tend to be quite different from the DSL you are working with. (While Kent Beck says that a testing framework should be in the same language as the code for TDD). Another problem is that none of them has managed to obtain the same reach and influence as the SQL based, with the notable exceptions of <code>great-expectations</code> (which can be a little quirky and slow to use) and the great <code>pydantic</code> (more oriented for APIs). The catch being again that they are not necessarily fitted for TDD in Data Science. Other defensive analysis packages for <code>pandas</code> such as <code>engarde</code> or <code>bulwark</code> are not maintained anymore. They also suffer from a decorator oriented approach and very sparse type-hinting, that is again not ideal for TDD. On the <code>polars</code> side, there is one obscure package called <code>pelage</code>, fairly similar to dbt tests, but the level of adoption seems to be currently on par with the number of working brain cells for the average Elon Musk fanboy…</p>
<p>In the end, if you have the possibility to jam as many tests as you can within your SQL pipelines, please knock yourself out! Worst case scenario, your analytics tables might end up having an actual working primary key, which would be a nice change once in a while… just saying… And who knows, you could accidentally end up with a dashboard in which the numbers are not just straight-up lies, nor a rough estimate but actually accurate…</p>
</section>
</section>
<section id="conclusion" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">7</span> Conclusion</h2>
<p>This glorious landscape made of lying dashboards, misleading analyses, and an astonishing 80% of machine learning projects that die without reaching production, are just a clear sign that our profession still lacks discipline. We will need to incorporate better practices in our work, which may take many different forms but I am sure that testing will be a part of it.</p>
<p>Sure, there are specific issues with data science that make it more difficult to test. Granted, you might not know if you are going to keep that freshly-made 500-line analysis. But let’s be real for a minute, the fact that your 500-lines have not been tested is probably a good reason why it will end up down the drain. The main reason you are probably not testing is that you have no idea how to do it on anything beyond FizzBuzz, let alone in a TDD workflow. Testing in Data Science is hard but do not kid yourself, it is doable and should be done. If anything the specific hardships of Data Science should make us yearn for already proven solutions that increase software reliability and decrease our cognitive burden. But I guess some people like their legacy projects served early in the morning with entire chucks of burn-out in them.</p>
<p>Clearly the “Dev” culture has not yet been imported in the Data Science world, and most of us definitely missed the DevOps train. Yet people who have jumped on it are out there. They deploy 5 times a day to production, use canary-release after training 10 models concurrently on perfect copies of their prod environment, after a simple commit-push. None of these steps can be reached without strict automated testing, nor a strong self-discipline such as not touching the production with greasy data scientist fingers. We should strive for better quality standards if we ever want to be considered as <strong>serious software engineers</strong>.</p>
<p>In the end, mastery is what we need. With this demonstration, I hope you are now absolutely convinced, as I am, of the imperious necessity of importing good testing strategies into Data Science. Otherwise, it’s better if you and I never find ourselves in the same room, because I will definitely reach for that shovel.</p>
<section id="good-reading" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="good-reading">Good Reading</h3>
<ul>
<li>Modern Software Engineering - David Farley - ISBN: 9780137314867</li>
<li>Extreme Programming Explained: Embrace Change - Beck, Kent; Andres, Cynthia - ISBN 10: 0321278658 / ISBN 13: 9780321278654</li>
<li>Team Topologies - Matthew Skelton; Manuel Pais - ISBN: 9781966280002</li>
<li>Accelerate: The Science of Lean Software and DevOps - Gene Kim, Jez Humble, Nicole Forsgren - ISBN 10: 1942788339 / ISBN 13: 9781942788331</li>
<li>Test Driven Development: By Example - Kent Beck - ISBN: 9780321146533</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ds-rants\.github\.io\/ds-rants\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>